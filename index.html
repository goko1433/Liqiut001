
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ProFinans v11 Quantum AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- PRO DESIGN SYSTEM v11 (Quantum Glass) --- */
        :root {
            --bg-body: #000000;
            --bg-card: #0F0F11;
            --bg-glass: rgba(15, 15, 17, 0.9);

            --primary: #0A84FF;
            --accent: #5E5CE6;
            --success: #32D74B;
            --danger: #FF453A;
            --warn: #FF9F0A;
            --gold: #FFD60A;
            --teal: #64D2FF;
            --purple: #BF5AF2;

            --text-main: #FFFFFF;
            --text-muted: #8E8E93;

            --border-glass: 1px solid rgba(255, 255, 255, 0.1);
            --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.6);
            --glow-primary: 0 0 30px rgba(10, 132, 255, 0.15);

            --font-main: 'Plus Jakarta Sans', sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

        body {
            margin: 0; padding: 0;
            background: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- PIN LOCK SCREEN --- */
        #pin-screen {
            position: fixed; inset: 0; background: #000; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.4s cubic-bezier(0.87, 0, 0.13, 1);
        }
        #pin-screen.unlocked { transform: translateY(-100%); pointer-events: none; }
        .pin-dots { display: flex; gap: 15px; margin-bottom: 40px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; border: 1px solid #333; transition: 0.2s; }
        .dot.filled { background: var(--primary); border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .pin-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
        .pin-btn {
            width: 75px; height: 75px; border-radius: 50%; background: rgba(255,255,255,0.08);
            display: flex; align-items: center; justify-content: center;
            font-size: 26px; font-weight: 500; cursor: pointer; border: 1px solid rgba(255,255,255,0.02);
            transition: 0.1s;
        }
        .pin-btn:active { background: rgba(255,255,255,0.2); transform: scale(0.95); }

        /* --- SPLASH SCREEN --- */
        #splash {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            transition: opacity 0.6s; pointer-events: none;
        }
        .q-loader {
            width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { to {transform: rotate(360deg);} }

        /* --- HEADER --- */
        header {
            padding: max(10px, env(safe-area-inset-top)) 20px 10px 20px;
            background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-bottom: var(--border-glass); z-index: 100;
            transition: box-shadow 0.5s;
        }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .user-chip {
            display: flex; align-items: center; gap: 10px;
            background: rgba(255,255,255,0.05); padding: 6px 12px 6px 6px;
            border-radius: 30px; border: var(--border-glass);
        }
        .avatar {
            width: 32px; height: 32px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--teal));
            display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;
        }
        .u-name { font-size: 13px; font-weight: 600; }

        .sys-status { width: 6px; height: 6px; border-radius: 50%; background: #333; transition: 0.3s; box-shadow: 0 0 5px #333; }
        .sys-status.online { background: var(--success); box-shadow: 0 0 8px var(--success); }

        /* TICKER SCROLL */
        .ticker-cont { overflow-x: auto; display: flex; gap: 10px; scrollbar-width: none; padding-bottom: 5px; }
        .ticker-cont::-webkit-scrollbar { display: none; }
        .tick-pill {
            background: var(--bg-card); min-width: 100px; padding: 8px 12px;
            border-radius: 12px; border: var(--border-glass);
            display: flex; flex-direction: column; gap: 2px;
        }
        .tp-head { font-size: 10px; color: var(--text-muted); font-weight: 700; letter-spacing: 0.5px; }
        .tp-val { font-size: 14px; font-weight: 700; font-variant-numeric: tabular-nums; }
        .flash-green { color: var(--success); animation: flashG 1s; }
        .flash-red { color: var(--danger); animation: flashR 1s; }
        @keyframes flashG { 0%{text-shadow:0 0 10px var(--success);} 100%{text-shadow:none;} }
        @keyframes flashR { 0%{text-shadow:0 0 10px var(--danger);} 100%{text-shadow:none;} }

        /* --- MAIN --- */
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 110px; }
        .tab-view { display: none; animation: fadeIn 0.4s ease; }
        .tab-view.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        /* CARDS */
        .card {
            background: var(--bg-card); border-radius: 24px; padding: 24px;
            border: var(--border-glass); margin-bottom: 20px;
            box-shadow: var(--shadow-card); position: relative; overflow: hidden;
        }
        .card-bg-fx {
            position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(10,132,255,0.06) 0%, transparent 60%);
            pointer-events: none;
        }

        /* HERO BALANCE */
        .lbl-sm { font-size: 11px; color: var(--text-muted); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; display: block; margin-bottom: 8px; }
        .big-bal {
            font-size: 42px; font-weight: 800; letter-spacing: -1.5px; margin-bottom: 20px;
            background: linear-gradient(180deg, #fff, #888);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            cursor: pointer;
        }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.08); border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .prog-fill { height: 100%; width: 0%; background: var(--primary); border-radius: 10px; box-shadow: var(--glow-primary); transition: width 0.5s linear; }

        /* AI CARD */
        .ai-card {
            background: linear-gradient(135deg, rgba(10,132,255,0.08), rgba(0,0,0,0));
            border: 1px solid rgba(10,132,255,0.15);
            display: flex; gap: 15px; align-items: flex-start;
        }
        .ai-icon {
            width: 40px; height: 40px; background: rgba(10,132,255,0.15); color: var(--primary);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; flex-shrink: 0; box-shadow: 0 0 15px rgba(10,132,255,0.1);
        }
        .ai-text h4 { margin: 0 0 4px 0; font-size: 15px; color: #fff; }
        .ai-text p { margin: 0; font-size: 12px; color: #ccc; line-height: 1.4; }

        /* NOTIFICATION TOAST */
        #toast {
            position: fixed; top: 110px; left: 50%; transform: translateX(-50%) translateY(-20px);
            background: rgba(15,15,15,0.95); backdrop-filter: blur(15px);
            border: 1px solid var(--border-glass); color: #fff;
            padding: 12px 24px; border-radius: 30px; font-size: 12px; font-weight: 600;
            opacity: 0; pointer-events: none; transition: 0.3s; z-index: 200;
            display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* GRID BUTTONS */
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 25px; }
        .g-btn {
            background: rgba(255,255,255,0.03); border-radius: 20px; padding: 16px 5px;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            border: var(--border-glass); transition: 0.2s; cursor: pointer; position: relative; overflow: hidden;
        }
        .g-btn:active { transform: scale(0.96); background: rgba(255,255,255,0.06); }
        .gb-icon { font-size: 24px; z-index: 2; }
        .gb-lbl { font-size: 10px; font-weight: 600; z-index: 2; letter-spacing: 0.3px; }

        /* LISTS */
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .lh-title { font-size: 17px; font-weight: 700; letter-spacing: -0.5px; }
        .lh-act { font-size: 12px; color: var(--primary); font-weight: 700; cursor: pointer; padding: 6px 12px; background: rgba(10,132,255,0.1); border-radius: 10px; transition: 0.2s; }
        .lh-act:active { background: rgba(10,132,255,0.2); }

        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; background: var(--bg-card); border-radius: 18px;
            border: var(--border-glass); margin-bottom: 10px;
        }
        .li-left { display: flex; gap: 14px; align-items: center; }
        .li-icon { width: 42px; height: 42px; border-radius: 14px; background: rgba(255,255,255,0.04); display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .li-txt h3 { margin: 0; font-size: 15px; font-weight: 600; }
        .li-txt p { margin: 3px 0 0 0; font-size: 11px; color: var(--text-muted); }
        .li-val { text-align: right; font-size: 15px; font-weight: 700; }

        /* CHART CANVAS */
        .chart-container {
            width: 220px; height: 220px; margin: 0 auto 20px auto; position: relative;
        }
        canvas { width: 100%; height: 100%; transform: rotate(-90deg); }
        .chart-legend { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; font-size: 11px; margin-bottom: 20px; }
        .legend-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }

        /* NAV */
        .btm-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-top: var(--border-glass);
            display: flex; justify-content: space-around;
            padding: 12px 0 max(20px, var(--safe-bottom)) 0; z-index: 90;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            width: 20%; color: #555; cursor: pointer; transition: 0.3s;
        }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; transition: 0.3s; }
        .nav-item span { font-size: 10px; font-weight: 600; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active svg { transform: translateY(-2px); filter: drop-shadow(0 0 10px var(--primary)); }

        /* MODALS */
        .modal-wrap {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200;
            opacity: 0; pointer-events: none; transition: 0.3s;
            display: flex; align-items: flex-end; justify-content: center;
            backdrop-filter: blur(8px);
        }
        .modal-wrap.open { opacity: 1; pointer-events: auto; }
        .modal-sheet {
            width: 100%; max-width: 600px; background: #151517;
            border-radius: 32px 32px 0 0; padding: 30px; padding-bottom: max(40px, var(--safe-bottom));
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            border-top: 1px solid rgba(255,255,255,0.1);
            max-height: 90vh; overflow-y: auto;
        }
        .modal-wrap.open .modal-sheet { transform: translateY(0); }

        input, select {
            width: 100%; padding: 18px; margin-bottom: 15px;
            background: #222; border: 1px solid transparent; border-radius: 16px;
            color: #fff; font-size: 16px; font-family: inherit; transition: 0.2s;
        }
        input:focus, select:focus { border-color: var(--primary); background: #282828; }

        .btn-full {
            width: 100%; padding: 18px; background: var(--primary); color: #fff;
            border: none; border-radius: 16px; font-size: 16px; font-weight: 700;
            cursor: pointer; box-shadow: var(--glow-primary); margin-bottom: 12px;
            transition: 0.2s;
        }
        .btn-full:active { transform: scale(0.98); }
        .btn-sec {
            width: 100%; padding: 16px; background: rgba(255,255,255,0.08); color: #fff;
            border: none; border-radius: 16px; font-size: 15px; font-weight: 600;
            cursor: pointer; margin-bottom: 10px; transition: 0.2s;
        }
        .btn-sec:active { background: rgba(255,255,255,0.12); }

        /* CALCULATOR GRID */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .c-btn {
            background: #2C2C2E; height: 65px; border-radius: 16px; font-size: 22px;
            display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer;
            transition: 0.1s;
        }
        .c-btn:active { background: #444; }
        .c-btn.op { background: var(--warn); color: #000; }
        .c-btn.eq { background: var(--primary); color: #fff; grid-column: span 2; }

        /* DEBT ITEM STYLES */
        .debt-inc { color: var(--success); }
        .debt-out { color: var(--danger); }

        /* UTILS */
        .hidden { display: none; }
        .flex-row { display: flex; gap: 10px; }
        .tag-row { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 20px; scrollbar-width: none; padding-right: 20px; }
        .tag { padding: 10px 18px; background: #2C2C2E; border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .tag.sel { background: var(--primary); color: #fff; border-color: rgba(255,255,255,0.2); }
        .history-date { font-size: 11px; color: var(--text-muted); margin-top: 20px; border-bottom: 1px solid #222; padding-bottom: 5px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <!-- PIN SCREEN -->
    <div id="pin-screen">
        <div style="margin-bottom:40px; text-align:center;">
            <div style="font-size:48px; margin-bottom:10px;">üîí</div>
            <h3 style="margin:0; font-weight:700;">Quantum Access</h3>
        </div>
        <div class="pin-dots">
            <div class="dot" id="d1"></div><div class="dot" id="d2"></div>
            <div class="dot" id="d3"></div><div class="dot" id="d4"></div>
        </div>
        <div class="pin-pad">
            <div class="pin-btn" onclick="pinHit(1)">1</div><div class="pin-btn" onclick="pinHit(2)">2</div><div class="pin-btn" onclick="pinHit(3)">3</div>
            <div class="pin-btn" onclick="pinHit(4)">4</div><div class="pin-btn" onclick="pinHit(5)">5</div><div class="pin-btn" onclick="pinHit(6)">6</div>
            <div class="pin-btn" onclick="pinHit(7)">7</div><div class="pin-btn" onclick="pinHit(8)">8</div><div class="pin-btn" onclick="pinHit(9)">9</div>
            <div class="pin-btn" style="background:transparent; border:none;"></div>
            <div class="pin-btn" onclick="pinHit(0)">0</div>
            <div class="pin-btn" style="background:transparent; border:none; font-size:22px;" onclick="pinHit('del')">‚å´</div>
        </div>
        <div style="margin-top:40px; font-size:12px; color:#444;">Varsayƒ±lan: 0000</div>
    </div>

    <!-- NOTIFICATION -->
    <div id="toast">‚ö†Ô∏è Bildirim</div>

    <!-- SPLASH SCREEN -->
    <div id="splash">
        <div class="q-loader"></div>
        <h2>ProFinans v11</h2>
        <span style="font-size:12px; color:#666; letter-spacing:2px; font-weight:600;">QUANTUM AI</span>
    </div>

    <!-- HEADER -->
    <header id="main-head">
        <div class="top-bar">
            <div class="user-chip" onclick="modal('m-settings')">
                <div class="avatar" id="u-av">U</div>
                <div style="display:flex; flex-direction:column;">
                    <span class="u-name" id="u-name">Kullanƒ±cƒ±</span>
                    <div style="display:flex; align-items:center; gap:4px; font-size:10px; color:#888;">
                        <div class="sys-status" id="ws-stat"></div> <span id="ws-txt">Baƒülanƒ±yor...</span>
                    </div>
                </div>
            </div>
            <div class="g-btn" style="padding:10px; border-radius:14px; width:44px; height:44px; background:rgba(255,255,255,0.05);" onclick="modal('m-settings')">
                ‚öôÔ∏è
            </div>
        </div>

        <div class="ticker-cont">
            <div class="tick-pill" id="tk-usd">
                <span class="tp-head">üá∫üá∏ USD/TRY</span>
                <span class="tp-val">--.--</span>
            </div>
            <div class="tick-pill" id="tk-eur">
                <span class="tp-head">üá™üá∫ EUR/TRY</span>
                <span class="tp-val">--.--</span>
            </div>
            <div class="tick-pill" id="tk-gold">
                <span class="tp-head">ü•á GR.ALTIN</span>
                <span class="tp-val">--.--</span>
            </div>
            <div class="tick-pill" id="tk-btc">
                <span class="tp-head">‚Çø BTC/USD</span>
                <span class="tp-val">--.--</span>
            </div>
        </div>
    </header>

    <main>
        <!-- TAB 1: DASHBOARD -->
        <div id="tab-home" class="tab-view active">

            <!-- Main Balance Card -->
            <div class="card">
                <div class="card-bg-fx"></div>
                <span class="lbl-sm">ANLIK HARCANABƒ∞Lƒ∞R NET BAKƒ∞YE</span>
                <div class="big-bal" id="val-bal" onclick="togglePriv()">‚Ç∫0,00</div>
                <div style="display:flex; justify-content:space-between; font-size:11px; color:#888;">
                    <span id="txt-start">Ba≈ülangƒ±√ß</span>
                    <span id="txt-pct">%0</span>
                    <span id="txt-end">Biti≈ü</span>
                </div>
                <div class="progress-bar"><div class="prog-fill" id="bar-fill"></div></div>
                <div style="margin-top:20px; display:flex; gap:10px;">
                     <button class="btn-sec" style="padding:10px; font-size:12px; margin:0; flex:1;" onclick="modal('m-spend')">‚ö° Hƒ±zlƒ± Harca</button>
                     <div style="padding:10px; font-size:12px; color:#888; display:flex; flex-direction:column; align-items:flex-end; justify-content:center;">
                        <span>Bug√ºn Harcanan</span>
                        <span id="daily-spend-val" style="color:#fff; font-weight:700;">‚Ç∫0</span>
                     </div>
                </div>
            </div>

            <!-- AI Insight Card -->
            <div class="card ai-card">
                <div class="ai-icon">üß†</div>
                <div class="ai-text">
                    <h4>Quantum AI Analizi</h4>
                    <p id="ai-msg">Veriler i≈üleniyor...</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="grid-4">
                <div class="g-btn" onclick="modal('m-history')">
                    <span class="gb-icon" style="color:#64D2FF">üìú</span>
                    <span class="gb-lbl">Ge√ßmi≈ü</span>
                </div>
                <div class="g-btn" onclick="modal('m-debt')">
                    <span class="gb-icon" style="color:#FF453A">ü§ù</span>
                    <span class="gb-lbl">Bor√ßlar</span>
                </div>
                 <div class="g-btn" onclick="modal('m-subs')">
                    <span class="gb-icon" style="color:#BF5AF2">üìÖ</span>
                    <span class="gb-lbl">Abonelik</span>
                </div>
                <div class="g-btn" onclick="modal('m-goal')">
                    <span class="gb-icon" style="color:#FFD60A">üéØ</span>
                    <span class="gb-lbl">Hedef</span>
                </div>
            </div>

            <!-- NEW: EXPENSE DISTRIBUTION CHART -->
             <div class="list-header"><span class="lh-title">Gider Analizi</span></div>
            <div class="card" style="display:flex; flex-direction:column; align-items:center;">
                <div class="chart-container">
                    <canvas id="spendChart" width="220" height="220"></canvas>
                </div>
                <div id="spend-legend" class="chart-legend"></div>
            </div>

            <!-- Expense Flow -->
            <div class="list-header">
                <span class="lh-title">Sabit Giderler</span>
                <span class="lh-act" onclick="modal('m-exp')">+ Ekle</span>
            </div>
            <div id="list-exp"></div>
        </div>

        <!-- TAB 2: ASSETS -->
        <div id="tab-assets" class="tab-view">
            <div class="list-header"><span class="lh-title">Portf√∂y√ºm</span></div>
            <div class="card" style="text-align:center;">
                <span class="lbl-sm">TOPLAM VARLIK DEƒûERƒ∞</span>
                <h1 style="margin:10px 0;" id="val-networth">‚Ç∫0,00</h1>
            </div>

            <div class="chart-container">
                <canvas id="assetChart" width="220" height="220"></canvas>
            </div>
            <div id="chart-legend" class="chart-legend"></div>

            <div id="list-asset"></div>
        </div>

        <!-- TAB 3: GOALS -->
        <div id="tab-goals" class="tab-view">
            <div class="list-header">
                <span class="lh-title">Hedeflerim</span>
                <span class="lh-act" onclick="modal('m-goal')">+ Yeni</span>
            </div>
            <div id="list-goals">
                <div style="text-align:center; padding:40px; color:#666;">Hen√ºz bir hedef belirlemedin.</div>
            </div>
        </div>

        <!-- TAB 4: TOOLS -->
        <div id="tab-tools" class="tab-view">
            <div class="list-header"><span class="lh-title">Ara√ßlar</span></div>

            <!-- Calculator -->
             <div class="card">
                <h3 style="margin-top:0;">Hesap Makinesi</h3>
                <input type="text" id="calc-disp" readonly style="text-align:right; font-size:28px; font-weight:700; letter-spacing:1px; background:transparent; border:none; padding:0 0 20px 0;" value="0">
                <div class="calc-grid">
                    <div class="c-btn" onclick="calcIn('7')">7</div>
                    <div class="c-btn" onclick="calcIn('8')">8</div>
                    <div class="c-btn" onclick="calcIn('9')">9</div>
                    <div class="c-btn op" onclick="calcIn('/')">√∑</div>
                    <div class="c-btn" onclick="calcIn('4')">4</div>
                    <div class="c-btn" onclick="calcIn('5')">5</div>
                    <div class="c-btn" onclick="calcIn('6')">6</div>
                    <div class="c-btn op" onclick="calcIn('*')">√ó</div>
                    <div class="c-btn" onclick="calcIn('1')">1</div>
                    <div class="c-btn" onclick="calcIn('2')">2</div>
                    <div class="c-btn" onclick="calcIn('3')">3</div>
                    <div class="c-btn op" onclick="calcIn('-')">-</div>
                    <div class="c-btn" onclick="calcIn('C')" style="color:#FF453A">C</div>
                    <div class="c-btn" onclick="calcIn('0')">0</div>
                    <div class="c-btn" onclick="calcIn('.')">.</div>
                    <div class="c-btn op" onclick="calcIn('+')">+</div>
                    <div class="c-btn eq" onclick="calcRes()">=</div>
                </div>
            </div>

            <!-- Converter -->
            <div class="card">
                <h3 style="margin-top:0;">D√∂viz √áevirici</h3>
                <div class="flex-row">
                    <input type="number" id="conv-amt" placeholder="Miktar" oninput="convert()" value="1">
                    <select id="conv-curr" onchange="convert()" style="width:100px;">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                    </select>
                </div>
                <div style="font-size:24px; font-weight:700; color:var(--primary);" id="conv-res">‚Ç∫32.00</div>
            </div>
        </div>

    </main>

    <!-- BOTTOM NAV -->
    <nav class="btm-nav">
        <div class="nav-item active" id="btn-home" onclick="nav('tab-home')">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>√ñzet</span>
        </div>
        <div class="nav-item" id="btn-assets" onclick="nav('tab-assets')">
            <svg viewBox="0 0 24 24"><path d="M4 10h3v7H4zM22 8.16L18.47 18a3.001 3.001 0 0 1-5.63.12l-1.48-3.95-3.95-1.48a3.001 3.001 0 0 1 .12-5.63L17.34 3.65c.98-.35 1.99.66 1.64 1.64.01 0 2.06 1.76 3.02 2.87z"/></svg>
            <span>Varlƒ±k</span>
        </div>
        <div class="nav-item" id="btn-goals" onclick="nav('tab-goals')">
            <svg viewBox="0 0 24 24"><path d="M19.03 3.56c-1.67-1.39-3.74-2.3-6.03-2.51v2.01c1.73.19 3.31.88 4.62 1.92l1.41-1.42zM11 3.05v2.01c-2.29.21-4.36 1.12-6.03 2.51l1.42 1.42C7.69 7.95 9.27 7.26 11 7.07zm9 13.95h-6v-3h-4v3H4v2h16v-2zm-3.56-8.5l-1.42 1.42c1.05 1.31 1.73 2.89 1.92 4.62h2.01c-.21-2.29-1.12-4.36-2.51-6.04z"/></svg>
            <span>Hedef</span>
        </div>
        <div class="nav-item" id="btn-tools" onclick="nav('tab-tools')">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 7h2v2H7V7zm0 4h2v2H7v-2zm0 4h2v2H7v-2zm6 2h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/></svg>
            <span>Ara√ßlar</span>
        </div>
    </nav>

    <!-- MODAL: SETTINGS -->
    <div class="modal-wrap" id="m-settings">
        <div class="modal-sheet">
            <h2>Ayarlar</h2>
            <input type="text" id="inp-name" placeholder="Adƒ±nƒ±z">
            <input type="number" id="inp-sal" placeholder="Net Maa≈ü (TL)">
            <div class="flex-row">
                <input type="number" id="inp-day" placeholder="Maa≈ü G√ºn√º (1-31)" min="1" max="31">
                <input type="number" id="inp-hour" placeholder="Saat (0-23)" min="0" max="23">
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-size:12px; color:#888;">PIN Kodu (Bo≈ü: Pasif)</label>
                <input type="number" id="inp-pin" placeholder="0000" maxlength="4">
            </div>
            <button class="btn-full" onclick="saveSet()">Kaydet</button>
            <div class="flex-row">
                <button class="btn-sec" onclick="exportCSV()">üìä Excel (CSV)</button>
                <button class="btn-sec" onclick="exportData()">‚¨áÔ∏è Yedek Al</button>
                <button class="btn-sec" onclick="document.getElementById('file-imp').click()">‚¨ÜÔ∏è Y√ºkle</button>
                <input type="file" id="file-imp" class="hidden" onchange="importData(this)">
            </div>
            <div style="text-align:center; margin-top:20px; color:var(--danger); font-size:12px;" onclick="resetApp()">Uygulamayƒ± Sƒ±fƒ±rla</div>
            <div style="text-align:center; margin-top:10px; color:#666;" onclick="closeModal('m-settings')">Kapat</div>
        </div>
    </div>

    <!-- MODAL: EXPENSE -->
    <div class="modal-wrap" id="m-exp">
        <div class="modal-sheet">
            <h2>Sabit Gider Ekle</h2>
            <input type="text" id="ex-name" placeholder="Ba≈ülƒ±k (√ñrn: Kira)">
            <input type="number" id="ex-amt" placeholder="Tutar (TL)">
            <button class="btn-full" onclick="addExp()">Ekle</button>
            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-exp')">ƒ∞ptal</div>
        </div>
    </div>

    <!-- MODAL: SUBSCRIPTION (NEW) -->
    <div class="modal-wrap" id="m-subs">
        <div class="modal-sheet">
            <h2>Abonelik Ekle</h2>
            <div style="font-size:12px; color:#888; margin-bottom:15px;">Netflix, Spotify, Gym gibi aylƒ±k tekrar eden √∂demeler.</div>
            <input type="text" id="sb-name" placeholder="Abonelik Adƒ±">
            <input type="number" id="sb-amt" placeholder="Aylƒ±k Tutar (TL)">
            <button class="btn-full" style="background:var(--purple);" onclick="addSub()">Kaydet</button>

            <div id="subs-list" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;"></div>

            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-subs')">Kapat</div>
        </div>
    </div>

    <!-- MODAL: DEBT (NEW) -->
    <div class="modal-wrap" id="m-debt">
        <div class="modal-sheet">
            <h2>Bor√ß & Alacak</h2>
            <div class="flex-row">
                <button class="btn-sec" id="btn-d-in" onclick="setDebtType('in')" style="background:var(--success); color:#000;">Alacaƒüƒ±m Var</button>
                <button class="btn-sec" id="btn-d-out" onclick="setDebtType('out')">Borcum Var</button>
            </div>
            <input type="text" id="db-name" placeholder="Ki≈üi Adƒ±">
            <input type="number" id="db-amt" placeholder="Tutar (TL)">
            <button class="btn-full" onclick="addDebt()">Kaydet</button>

            <div id="debt-list" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;"></div>

            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-debt')">Kapat</div>
        </div>
    </div>

    <!-- MODAL: HISTORY -->
    <div class="modal-wrap" id="m-history">
        <div class="modal-sheet" style="height:80vh;">
            <h2>ƒ∞≈ülem Ge√ßmi≈üi</h2>
            <div id="hist-list" style="padding-bottom:20px;"></div>
            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-history')">Kapat</div>
        </div>
    </div>

    <!-- MODAL: QUICK SPEND -->
    <div class="modal-wrap" id="m-spend">
        <div class="modal-sheet">
            <h2>‚ö° Hƒ±zlƒ± Harcama</h2>
            <div class="tag-row">
                <div class="tag" onclick="fillSpend('Market')">Market</div>
                <div class="tag" onclick="fillSpend('Yemek')">Yemek</div>
                <div class="tag" onclick="fillSpend('Ula≈üƒ±m')">Ula≈üƒ±m</div>
                <div class="tag" onclick="fillSpend('Eƒülence')">Eƒülence</div>
                <div class="tag" onclick="fillSpend('Fatura')">Fatura</div>
                <div class="tag" onclick="fillSpend('Kahve')">Kahve</div>
            </div>
            <input type="text" id="sp-name" placeholder="Harcama Adƒ±">
            <input type="number" id="sp-amt" placeholder="Tutar (TL)">
            <button class="btn-full" onclick="addSpend()">Harcamayƒ± D√º≈ü</button>
            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-spend')">ƒ∞ptal</div>
        </div>
    </div>

    <!-- MODAL: ASSET -->
    <div class="modal-wrap" id="m-asset">
        <div class="modal-sheet">
            <h2>Varlƒ±k Ekle</h2>
            <select id="as-type">
                <option value="USD">Amerikan Dolarƒ± ($)</option>
                <option value="EUR">Euro (‚Ç¨)</option>
                <option value="GOLD">Gram Altƒ±n</option>
                <option value="BTC">Bitcoin</option>
                <option value="TRY">Nakit TL</option>
            </select>
            <input type="number" id="as-amt" placeholder="Miktar (Adet)">
            <button class="btn-full" onclick="addAs()">Ekle</button>
            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-asset')">ƒ∞ptal</div>
        </div>
    </div>

    <!-- MODAL: GOAL -->
    <div class="modal-wrap" id="m-goal">
        <div class="modal-sheet">
            <h2>Hedef Ekle</h2>
            <input type="text" id="gl-name" placeholder="Hedef (√ñrn: Araba)">
            <input type="number" id="gl-target" placeholder="Hedef Tutar (TL)">
            <input type="number" id="gl-curr" placeholder="≈ûu anki Birikim (TL)">
            <button class="btn-full" style="background:var(--gold); color:#000;" onclick="addGoal()">Hedef Olu≈ütur</button>
            <div style="text-align:center; margin-top:15px; color:#666;" onclick="closeModal('m-goal')">ƒ∞ptal</div>
        </div>
    </div>

    <script>
        // --- CORE & DATA ---
        let app = {
            name: 'Kullanƒ±cƒ±', salary: 0, day: 1, hour: 9, pin: '0000',
            expenses: [], assets: [], goals: [], spends: [], subs: [], debts: []
        };
        let rates = { USD:32.0, EUR:34.5, GOLD:2000, BTC:40000, TRY:1 };
        let privMode = false;
        let enteredPin = "";
        let calcVal = "";
        let debtType = 'in'; // in:alacak, out:borc

        // --- INIT ---
        window.onload = () => {
            const saved = localStorage.getItem('PF_v11_Data');
            if(saved) app = JSON.parse(saved);

            // Migrations for v11
            if(!app.spends) app.spends = [];
            if(!app.subs) app.subs = [];
            if(!app.debts) app.debts = [];
            if(app.pin === undefined) app.pin = '0000';

            // PIN Check
            if(app.pin && app.pin.length === 4) {
                // Wait for PIN
            } else {
                document.getElementById('pin-screen').classList.add('unlocked');
            }

            setTimeout(() => document.getElementById('splash').style.opacity = '0', 1000);
            setTimeout(() => document.getElementById('splash').style.display = 'none', 1500);

            startBinance();
            renderAll();
            requestAnimationFrame(tickLoop);
        };

        // --- PIN LOGIC ---
        function pinHit(n) {
            if(n === 'del') {
                enteredPin = enteredPin.slice(0, -1);
            } else if (enteredPin.length < 4) {
                enteredPin += n;
                vibrate();
            }

            // Update dots
            for(let i=1; i<=4; i++) {
                if(i <= enteredPin.length) document.getElementById('d'+i).classList.add('filled');
                else document.getElementById('d'+i).classList.remove('filled');
            }

            // Check
            if(enteredPin.length === 4) {
                if(enteredPin === app.pin) {
                    setTimeout(() => document.getElementById('pin-screen').classList.add('unlocked'), 200);
                } else {
                    enteredPin = "";
                    document.querySelectorAll('.dot').forEach(d=>d.classList.remove('filled'));
                    showToast('‚ùå Hatalƒ± PIN!');
                    vibrate();
                }
            }
        }

        // --- CALCULATOR ---
        function calcIn(v) {
            if(v==='C') calcVal = "";
            else calcVal += v;
            document.getElementById('calc-disp').value = calcVal || "0";
            vibrate();
        }
        function calcRes() {
            try {
                if(/[^0-9+\-*/.]/.test(calcVal)) throw "Err";
                calcVal = eval(calcVal).toString();
                document.getElementById('calc-disp').value = calcVal;
            } catch(e) { document.getElementById('calc-disp').value = "Hata"; calcVal=""; }
        }

        // --- QUANTUM AI LOGIC ---
        function runAI() {
            const totalExp = app.expenses.reduce((a,b)=>a+b.amt,0);
            const totalSubs = app.subs.reduce((a,b)=>a+b.amt,0);
            const totalSpend = app.spends.reduce((a,b)=>a+b.amt,0);
            const net = app.salary - totalExp - totalSubs;

            const msgEl = document.getElementById('ai-msg');
            let msgs = [];

            if(app.salary === 0) {
                msgs.push("Ayarlar men√ºs√ºnden maa≈üƒ±nƒ± girerek Quantum analizini ba≈ülat.");
            } else {
                if(totalSubs > 0) msgs.push(`Aboneliklere yƒ±lda ${fmt(totalSubs*12)} harcƒ±yorsun. Biraz fazla mƒ±?`);

                const debtIn = app.debts.filter(d=>d.type==='in').reduce((a,b)=>a+b.amt,0);
                if(debtIn > 0) msgs.push(`Dƒ±≈üarƒ±da bekleyen ${fmt(debtIn)} alacaƒüƒ±n var. Hatƒ±rlatmak ister misin?`);

                if(totalSpend > net * 0.5) msgs.push("Dikkat! Deƒüi≈üken harcamalarƒ±n limiti zorluyor.");

                // Market
                if(rates.BTC < 38000) showToast("üìâ Bitcoin sert d√º≈üt√º! Yatƒ±rƒ±m fƒ±rsatƒ±?");
                if(rates.GOLD > 2500) showToast("üìà Altƒ±n tarihi zirveyi g√∂rd√º!");
            }

            msgEl.innerText = msgs.length > 0 ? msgs[Math.floor(Math.random()*msgs.length)] : "Finansal rotan ≈üu an stabil g√∂r√ºn√ºyor.";
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 4000);
            vibrate();
        }

        // --- MARKET DATA ---
        function startBinance() {
            const ws = new WebSocket("wss://stream.binance.com:9443/stream?streams=usdttry@miniTicker/eurusdt@miniTicker/paxgusdt@miniTicker/btcusdt@miniTicker");
            ws.onopen = () => {
                document.getElementById('ws-stat').classList.add('online');
                document.getElementById('ws-txt').innerText = "Canlƒ±";
            };
            ws.onmessage = (e) => {
                const d = JSON.parse(e.data);
                const p = parseFloat(d.data.c);
                const s = d.stream;

                if(s.includes('usdttry')) updateRate('USD', p, 'tk-usd', '$');
                if(s.includes('eurusdt')) updateRate('EUR', p * rates.USD, 'tk-eur', '‚Ç¨'); 
                if(s.includes('paxgusdt')) updateRate('GOLD', (p * rates.USD)/31.1035, 'tk-gold', '‚Ç∫');
                if(s.includes('btcusdt')) updateRate('BTC', p, 'tk-btc', '$');
            };
        }

        function updateRate(cur, val, elId, sym) {
            rates[cur] = val;
            const el = document.querySelector(`#${elId} .tp-val`);
            const old = parseFloat(el.getAttribute('d-val')) || val;
            el.innerText = sym + (cur==='BTC'?val.toLocaleString():val.toFixed(2));
            el.setAttribute('d-val', val);

            if(val !== old) {
                el.className = 'tp-val ' + (val > old ? 'flash-green' : 'flash-red');
                setTimeout(()=>el.className='tp-val', 1000);
            }
            if(document.getElementById('tab-assets').classList.contains('active')) renderAssets();
            if(document.getElementById('tab-tools').classList.contains('active')) convert();
        }

        // --- MAIN LOOP ---
        function tickLoop() {
            const now = new Date();
            let start = new Date(now.getFullYear(), now.getMonth(), app.day, app.hour, 0,0);
            if(now < start) start.setMonth(start.getMonth()-1);
            let end = new Date(start); end.setMonth(end.getMonth()+1);

            const pct = Math.min(1, Math.max(0, (now - start) / (end - start)));

            const totalExp = app.expenses.reduce((a,b)=>a+b.amt,0);
            const totalSubs = app.subs.reduce((a,b)=>a+b.amt,0);
            const totalSpend = app.spends.reduce((a,b)=>a+b.amt,0); 

            // Net = Salary - Fixed - Subs
            const net = app.salary - totalExp - totalSubs;

            // Live = Net (decayed by time) - Instant Spends
            let live = (net * (1-pct)) - totalSpend;
            if(live < 0) live = 0; 

            document.getElementById('val-bal').innerText = privMode ? '****' : fmt(live);
            document.getElementById('bar-fill').style.width = (pct*100)+'%';
            document.getElementById('txt-pct').innerText = '%'+(pct*100).toFixed(4);
            document.getElementById('txt-start').innerText = start.getDate() + ' ' + start.toLocaleString('default',{month:'short'});
            document.getElementById('txt-end').innerText = end.getDate() + ' ' + end.toLocaleString('default',{month:'short'});

            // Daily Spend Calculation
            const today = new Date().toDateString();
            const daily = app.spends.filter(s => new Date(s.date).toDateString() === today).reduce((a,b)=>a+b.amt,0);
            document.getElementById('daily-spend-val').innerText = fmt(daily);

            app.expenses.forEach(ex => {
                const el = document.getElementById('ex-live-'+ex.id);
                if(el) el.innerText = privMode ? '***' : '-' + fmt(ex.amt * pct);
            });

            requestAnimationFrame(tickLoop);
        }

        // --- RENDER UI ---
        function renderAll() {
            document.getElementById('u-name').innerText = app.name;
            document.getElementById('u-av').innerText = app.name[0].toUpperCase();

            // Expenses & History
            const elExp = document.getElementById('list-exp');
            elExp.innerHTML = '';
            app.expenses.forEach(x => {
                elExp.innerHTML += `
                <div class="list-item">
                    <div class="li-left">
                        <div class="li-icon" style="color:#FF453A">üìâ</div>
                        <div class="li-txt"><h3>${x.name}</h3><p>Sabit: -${x.amt}‚Ç∫</p></div>
                    </div>
                    <div class="li-val" style="color:#FF453A" id="ex-live-${x.id}">...</div>
                    <div style="font-size:18px; color:#666; cursor:pointer;" onclick="delItem('exp', ${x.id})">√ó</div>
                </div>`;
            });

            renderHistory();
            renderAssets();
            renderGoals();
            renderSpendChart();
            renderSubs();
            renderDebts();
            runAI();
        }

        function renderSubs() {
            const list = document.getElementById('subs-list');
            list.innerHTML = '';
            app.subs.forEach(s => {
                list.innerHTML += `
                <div class="list-item" style="padding:10px; border:none; background:rgba(255,255,255,0.03);">
                    <div class="li-left">
                        <div class="li-txt"><h3>${s.name}</h3><p>Yƒ±llƒ±k: ${fmt(s.amt*12)}</p></div>
                    </div>
                    <div class="li-val">-${fmt(s.amt)}</div>
                    <div style="font-size:16px; color:#666; margin-left:10px; cursor:pointer;" onclick="delItem('sub', ${s.id})">√ó</div>
                </div>`;
            });
        }

        function renderDebts() {
            const list = document.getElementById('debt-list');
            list.innerHTML = '';
            app.debts.forEach(d => {
                const color = d.type==='in' ? 'var(--success)' : 'var(--danger)';
                const sign = d.type==='in' ? '+' : '-';
                list.innerHTML += `
                <div class="list-item" style="padding:10px; border:none; background:rgba(255,255,255,0.03);">
                    <div class="li-left">
                        <div class="li-txt"><h3>${d.name}</h3><p>${d.type==='in'?'Alacak':'Bor√ß'}</p></div>
                    </div>
                    <div class="li-val" style="color:${color}">${sign}${fmt(d.amt)}</div>
                    <div style="font-size:16px; color:#666; margin-left:10px; cursor:pointer;" onclick="delItem('debt', ${d.id})">√ó</div>
                </div>`;
            });
        }

        function renderHistory() {
            const hList = document.getElementById('hist-list');
            hList.innerHTML = '';
            const sorted = [...app.spends].sort((a,b) => new Date(b.date) - new Date(a.date));
            let lastDate = '';

            sorted.forEach(x => {
                const d = new Date(x.date).toLocaleDateString('tr-TR');
                if(d !== lastDate) {
                    hList.innerHTML += `<div class="history-date">${d}</div>`;
                    lastDate = d;
                }
                hList.innerHTML += `
                <div class="list-item" style="padding:10px 0; background:transparent; border:none; border-bottom:1px solid rgba(255,255,255,0.05);">
                    <div class="li-left">
                        <div class="li-txt"><h3>${x.name}</h3><p>${new Date(x.date).toLocaleTimeString().slice(0,5)}</p></div>
                    </div>
                    <div class="li-val" style="color:var(--warn)">-${fmt(x.amt)}</div>
                    <div style="font-size:18px; color:#666; cursor:pointer; margin-left:10px;" onclick="delItem('spend', ${x.id})">√ó</div>
                </div>`;
            });
        }

        function renderSpendChart() {
            let map = {};
            app.spends.forEach(s => { map[s.name] = (map[s.name] || 0) + s.amt; });
            let data = Object.keys(map).map(k => ({label:k, val:map[k], color: getHashColor(k)}));
            const total = data.reduce((a,b)=>a+b.val,0);
            drawChart('spendChart', 'spend-legend', data, total);
        }

        function renderAssets() {
            const elAs = document.getElementById('list-asset');
            elAs.innerHTML = '';
            let total = 0;
            let chartData = [];

            app.assets.forEach(x => {
                let r = x.type==='BTC' ? rates.BTC*rates.USD : (rates[x.type]||1);
                let val = x.amt * r;
                total += val;
                chartData.push({label: x.type, val: val, color: getColor(x.type)});

                let icon = x.type==='GOLD'?'ü•á':(x.type==='BTC'?'‚Çø':(x.type==='EUR'?'üí∂':'üíµ'));
                elAs.innerHTML += `
                <div class="list-item">
                    <div class="li-left">
                        <div class="li-icon" style="color:${getColor(x.type)}">${icon}</div>
                        <div class="li-txt"><h3>${x.type}</h3><p>${x.amt} Adet</p></div>
                    </div>
                    <div class="li-val" style="color:${getColor(x.type)}">${privMode?'***':fmt(val)}</div>
                    <div style="font-size:18px; color:#666; cursor:pointer;" onclick="delItem('as', ${x.id})">√ó</div>
                </div>`;
            });
            document.getElementById('val-networth').innerText = privMode ? '****' : fmt(total);
            drawChart('assetChart', 'chart-legend', chartData, total);
        }

        function drawChart(cvsId, legId, data, total) {
            const cvs = document.getElementById(cvsId);
            const ctx = cvs.getContext('2d');
            const leg = document.getElementById(legId);
            ctx.clearRect(0,0,220,220);
            leg.innerHTML = '';

            if(total === 0) {
                ctx.beginPath(); ctx.arc(110,110,90,0,Math.PI*2);
                ctx.strokeStyle = '#222'; ctx.lineWidth = 15; ctx.stroke();
                return;
            }

            let start = 0;
            data.forEach(d => {
                const slice = (d.val / total) * 2 * Math.PI;
                ctx.beginPath();
                ctx.arc(110,110,90, start, start+slice);
                ctx.strokeStyle = d.color;
                ctx.lineWidth = 20;
                ctx.stroke();
                start += slice;
                leg.innerHTML += `<div style="display:flex;align-items:center;"><div class="legend-dot" style="background:${d.color}"></div>${d.label}</div>`;
            });
        }

        function getColor(type) {
            const c = { USD:'#32D74B', EUR:'#0A84FF', GOLD:'#FFD60A', BTC:'#FF9F0A' };
            return c[type] || '#8E8E93';
        }
        function getHashColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return '#' + "00000".substring(0, 6 - c.length) + c;
        }

        function renderGoals() {
            const elG = document.getElementById('list-goals');
            elG.innerHTML = '';
            if(app.goals.length === 0) {
                elG.innerHTML = '<div style="text-align:center; padding:20px; color:#444;">Hedef eklemek i√ßin + butonuna bas.</div>';
                return;
            }
            app.goals.forEach(g => {
                let pct = Math.min(100, (g.current / g.target)*100);
                elG.innerHTML += `
                <div class="goal-item" style="margin-bottom:15px; background:var(--bg-card); padding:15px; border-radius:18px; border:var(--border-glass);">
                    <div class="gi-head" style="display:flex; justify-content:space-between; font-size:13px; font-weight:600; margin-bottom:8px;">
                        <span>${g.name}</span>
                        <span>${fmt(g.current)} / ${fmt(g.target)}</span>
                    </div>
                    <div class="gi-track" style="height:8px; background:#222; border-radius:4px; overflow:hidden;"><div class="gi-fill" style="height:100%; width:${pct}%; background:linear-gradient(90deg, var(--gold), #FF9F0A);"></div></div>
                    <div style="text-align:right; margin-top:5px; font-size:11px; color:#888; cursor:pointer;" onclick="delItem('goal', ${g.id})">Sil</div>
                </div>`;
            });
        }

        // --- ACTIONS ---
        function modal(id) { document.getElementById(id).classList.add('open'); vibrate(); if(id==='m-history') renderHistory(); if(id==='m-subs') renderSubs(); if(id==='m-debt') renderDebts(); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        function nav(id) {
            document.querySelectorAll('.tab-view').forEach(e=>e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
            if(id.includes('home')) document.getElementById('btn-home').classList.add('active');
            if(id.includes('assets')) document.getElementById('btn-assets').classList.add('active');
            if(id.includes('goals')) document.getElementById('btn-goals').classList.add('active');
            if(id.includes('tools')) document.getElementById('btn-tools').classList.add('active');
            vibrate();
            if(id === 'tab-assets') renderAssets();
        }

        function saveSet() {
            app.name = document.getElementById('inp-name').value || 'Kullanƒ±cƒ±';
            app.salary = parseFloat(document.getElementById('inp-sal').value) || 0;
            app.day = parseInt(document.getElementById('inp-day').value) || 1;
            app.hour = parseInt(document.getElementById('inp-hour').value) || 9;
            const p = document.getElementById('inp-pin').value;
            if(p && p.length === 4) app.pin = p;
            else if (p === '') app.pin = '0000'; // Reset
            save(); closeModal('m-settings'); renderAll();
        }

        function addExp() {
            const n = document.getElementById('ex-name').value;
            const a = parseFloat(document.getElementById('ex-amt').value);
            if(n && a) { app.expenses.push({id:Date.now(), name:n, amt:a}); save(); closeModal('m-exp'); renderAll(); }
        }

        function addSub() {
            const n = document.getElementById('sb-name').value;
            const a = parseFloat(document.getElementById('sb-amt').value);
            if(n && a) { app.subs.push({id:Date.now(), name:n, amt:a}); save(); renderSubs(); renderAll(); document.getElementById('sb-name').value=''; }
        }

        function setDebtType(t) {
            debtType = t;
            document.getElementById('btn-d-in').style.background = t==='in' ? 'var(--success)' : 'rgba(255,255,255,0.1)';
            document.getElementById('btn-d-in').style.color = t==='in' ? '#000' : '#fff';
            document.getElementById('btn-d-out').style.background = t==='out' ? 'var(--danger)' : 'rgba(255,255,255,0.1)';
            document.getElementById('btn-d-out').style.color = t==='out' ? '#fff' : '#fff';
        }

        function addDebt() {
            const n = document.getElementById('db-name').value;
            const a = parseFloat(document.getElementById('db-amt').value);
            if(n && a) { app.debts.push({id:Date.now(), name:n, amt:a, type:debtType}); save(); renderDebts(); document.getElementById('db-name').value=''; }
        }

        function fillSpend(txt) { document.getElementById('sp-name').value = txt; }
        function addSpend() {
            const n = document.getElementById('sp-name').value;
            const a = parseFloat(document.getElementById('sp-amt').value);
            if(n && a) { 
                app.spends.push({id:Date.now(), name:n, amt:a, date: new Date().toISOString()}); 
                save(); closeModal('m-spend'); renderAll(); 
            }
        }

        function addAs() {
            const t = document.getElementById('as-type').value;
            const a = parseFloat(document.getElementById('as-amt').value);
            if(a) { app.assets.push({id:Date.now(), type:t, amt:a}); save(); closeModal('m-asset'); renderAll(); }
        }

        function addGoal() {
            const n = document.getElementById('gl-name').value;
            const t = parseFloat(document.getElementById('gl-target').value);
            const c = parseFloat(document.getElementById('gl-curr').value);
            if(n && t) { app.goals.push({id:Date.now(), name:n, target:t, current:c||0}); save(); closeModal('m-goal'); renderAll(); }
        }

        function delItem(type, id) {
            if(!confirm('Silinsin mi?')) return;
            if(type==='exp') app.expenses = app.expenses.filter(x=>x.id!==id);
            if(type==='as') app.assets = app.assets.filter(x=>x.id!==id);
            if(type==='goal') app.goals = app.goals.filter(x=>x.id!==id);
            if(type==='spend') app.spends = app.spends.filter(x=>x.id!==id);
            if(type==='sub') app.subs = app.subs.filter(x=>x.id!==id);
            if(type==='debt') app.debts = app.debts.filter(x=>x.id!==id);
            save(); renderAll();
        }

        function convert() {
            const amt = parseFloat(document.getElementById('conv-amt').value)||0;
            const cur = document.getElementById('conv-curr').value;
            const res = amt * rates[cur];
            document.getElementById('conv-res').innerText = fmt(res);
        }

        // Data Features
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(app));
            const node = document.createElement('a');
            node.setAttribute("href", dataStr);
            node.setAttribute("download", "ProFinans_Yedek.json");
            document.body.appendChild(node); node.click(); node.remove();
        }

        function exportCSV() {
            let csv = "Tarih,Islem,Tutar\n";
            app.spends.forEach(s => {
                csv += `${new Date(s.date).toLocaleDateString()},${s.name},-${s.amt}\n`;
            });
            app.expenses.forEach(e => { csv += `Sabit,${e.name},-${e.amt}\n`; });
            app.subs.forEach(s => { csv += `Abonelik,${s.name},-${s.amt}\n`; });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "ProFinans_Rapor.csv";
            link.click();
        }

        function importData(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if(json.salary !== undefined) {
                        app = json;
                        save(); renderAll(); alert("Yedek ba≈üarƒ±yla y√ºklendi!");
                    }
                } catch(err) { alert("Hatalƒ± dosya."); }
            };
            reader.readAsText(file);
        }

        function togglePriv() { privMode=!privMode; renderAll(); vibrate(); }
        function save() { localStorage.setItem('PF_v11_Data', JSON.stringify(app)); }
        function fmt(n) { return '‚Ç∫' + n.toLocaleString('tr-TR', {minimumFractionDigits:2, maximumFractionDigits:2}); }
        function vibrate() { if(navigator.vibrate) navigator.vibrate(10); }
        function resetApp() { if(confirm('T√ºm veriler silinecek!')) { localStorage.removeItem('PF_v11_Data'); location.reload(); }}

    </script>
</body>
</html>
